{"version":3,"sources":["LocationService.js"],"names":["GMAP_KEY","GMAP_BASE_URL","YELP_BASE_URL","YELP_CONSUMER_KEY","YELP_CONSUMER_SECRET","YELP_TOKEN","YELP_TOKEN_SECRET","CURRENT_LOCATION","lat","lng","yelpLocations","markerArray","infoWindow","bounds","map","panorama","fenway","setMarkers","locationArray","clearMarkers","$","each","index","location","createMarker","fitBounds","DIMS","width","setZoom","marker","setMap","createStreetView","svLocation","google","maps","StreetViewPanorama","document","getElementById","position","pov","heading","pitch","setStreetView","latlng","LatLng","Marker","title","name","animation","Animation","DROP","extend","parseURL","url","content","address","phone","ratingImage","event","addListener","getAnimation","setAnimation","BOUNCE","setTimeout","setContent","open","setCenter","getPosition","push","getYelpData","params","oauth_consumer_key","oauth_token","oauth_nonce","nonceString","oauth_timestamp","Math","floor","Date","now","oauth_signature_method","oauth_version","callback","term","limit","oauth_signature","oauthSignature","generate","ajax","data","cache","async","dataType","done","loc","businesses","locObject","id","display_phone","coordinate","latitude","longitude","display_address","rating_img_url","length","vm","locations","stopLoading","fail","errorHandler","initializeMap","mapContainer","mapOptions","zoom","center","mapTypeId","MapTypeId","ROADMAP","mapTypeControl","streetViewControl","InfoWindow","LatLngBounds","Map","LOCATIONS","ko","applyBindings","msg","html","modal"],"mappings":"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","file":"LocationService.js","sourcesContent":["const GMAP_KEY = 'AIzaSyBom-cjRo-fy7JXK7UcX--BhKweCRXCGSM';\nconst GMAP_BASE_URL = 'http://maps.googleapis.com/maps/';\n\n// AIzaSyBom-cjRo-fy7JXK7UcX--BhKweCRXCGSM\n\nconst YELP_BASE_URL = 'http://api.yelp.com/v2/search/';\nconst YELP_CONSUMER_KEY = 'QDjUDjcyJm01dz_NPhUlRw';\nconst YELP_CONSUMER_SECRET = 'rKa0IsIz0xRnA1PpKdi_DMsIsWQ';\nconst YELP_TOKEN = 'tJL7VrTzLMTY2oLMLNnccRx2_sqtjgLe';\nconst YELP_TOKEN_SECRET = 'GO3wgsHu58M67PwuiQMtjtUkFPc';\n\n// Consumer Key\tQDjUDjcyJm01dz_NPhUlRw\n// Consumer Secret\trKa0IsIz0xRnA1PpKdi_DMsIsWQ\n// Token\ttJL7VrTzLMTY2oLMLNnccRx2_sqtjgLe\n// Token Secret\tGO3wgsHu58M67PwuiQMtjtUkFPc\n\n// https://api.yelp.com/oauth2/token\n// App ID\n// K9Pvl_e7--ZTrD7p49MSfw\n// App Secret\n// 6Wdrh6d0xtGnErhSypBhfYTMUQ2NQVxg20TkThTjs2wHU3nrypA0xJO7rCNHPifv\n\n// enter the lat & long of your desired location\nconst CURRENT_LOCATION = { lat: 38.900138, lng: -77.044532};\n\nvar yelpLocations = [];\nvar markerArray = [];\nvar infoWindow;\nvar bounds;\n\nvar map = null;\nvar panorama = null;\nvar fenway = {lat: 52.527797, lng: 13.394694};\n\n/*\n  Places all markers on the map\n  @param locationArray - location with data retrieved from Yelp\n*/\nfunction setMarkers(locationArray) {\n  clearMarkers();\n  $.each(locationArray, function(index, location) {\n    createMarker(location);\n  });\n\n  // center the map\n  map.fitBounds(bounds);\n  if (DIMS.width > 662) {\n    map.setZoom(16);\n  }\n}\n\n// Clears existing markers that are displayed\nfunction clearMarkers() {\n  $.each(markerArray, function(index, marker) {\n    marker.setMap(null);\n  });\n  markerArray = [];\n}\n\n/*\nFunction for streetview stuff\n*/\n\nfunction createStreetView(svLocation){\n\n  panorama = new google.maps.StreetViewPanorama(\n\n      document.getElementById('pano'), {\n        position: svLocation,\n        pov: {\n          heading: 14,\n          pitch: 2\n        }\n      });\n\n  map.setStreetView(panorama);\n\n}\n\n/*\n  Creates markers from a location object\n  @param location - a location object containing data from Yelp\n*/\nfunction createMarker(location) {\n  var latlng = new google.maps.LatLng(location.lat, location.lng);\n  var marker = new google.maps.Marker({\n    title: location.name,\n    position: latlng,\n    map: map,\n    animation: google.maps.Animation.DROP,\n  });\n\n  // extend the map bounds to include marker position\n  bounds.extend(marker.position);\n\n  var parseURL;\n  if (location.url === '') {\n    parseURL = '\">';\n  } else {\n    parseURL = (location.url || '#') + '\" target=\"_blank\">Visit Website';\n  }\n\n  var content = '<div id=\"venue\">' +\n    '<h5 class=\"venue-name\">' + (location.name || '') + '</h5>' +\n    '<div class=\"venue-address\">' + (location.address[0] || '') +\n    '<br>' + (location.address[2] || location.address[1] || '') + '</div>' +\n    '<div class=\"venue-contact\">' + (location.phone || '') + '</div>' +\n    '<div class=\"venue-url\"><a href=\"' + parseURL + '</a></div>' +\n    '<div class=\"venue-rating\" style=\"margin-top:10px\"><img src=\"' + (location.ratingImage || '' ) +'\" /></div>' +\n    '</div>';\n\n  google.maps.event.addListener(marker, 'click', function() {\n\n    if (marker.getAnimation() !== null) {\n      marker.setAnimation(null);\n    } else {\n      marker.setAnimation(google.maps.Animation.BOUNCE);\n      setTimeout( function() { marker.setAnimation(null); }, 700 * 2);\n    }\n    infoWindow.setContent(content);\n    infoWindow.open(map, marker);\n    map.setCenter(marker.getPosition());\n\n    // fenway = {52.526836, 13.393152};\n    fenway = {lat: marker.getPosition().lat(), lng: marker.getPosition().lng()};\n    createStreetView(fenway);\n\n  });\n\n  location.marker = marker;\n  markerArray.push(marker);\n}\n\n/*\n  Retrieve location data from Yelp API\n  @param locationArray - a list of location objects with a name, coordinates, and address\n*/\nfunction getYelpData(locationArray) {\n  // fetch data for each location in the array\n  $.each(locationArray, function(index, location) {\n    var params = {\n      oauth_consumer_key: YELP_CONSUMER_KEY,\n      oauth_token: YELP_TOKEN,\n      oauth_nonce: nonceString(15),\n      oauth_timestamp: Math.floor(Date.now() / 1000),\n      oauth_signature_method: 'HMAC-SHA1',\n      oauth_version: '1.0',\n      callback: 'cb',\n      term: location.name,\n      location: 'Berlin, Germany',\n      limit: 1\n    };\n\n    // generate an oauth signature\n    params.oauth_signature = oauthSignature.generate(\n      'GET',\n      YELP_BASE_URL,\n      params,\n      YELP_CONSUMER_SECRET,\n      YELP_TOKEN_SECRET\n    );\n\n    // call the API\n    $.ajax({\n      url: YELP_BASE_URL,\n      data: params,\n      cache: true,\n      async: true,\n      dataType: 'jsonp',\n    }).done(function(data) {\n      var loc = data.businesses[0];\n      var locObject = {\n        id: loc.id || '',\n        name: loc.name || location.name,\n        phone: loc.display_phone || '',\n        url: loc.url || '',\n        lat: loc.location.coordinate.latitude || location.lat,\n        lng: loc.location.coordinate.longitude || location.lng,\n        address: loc.location.display_address || location.address,\n        ratingImage: loc.rating_img_url || '',\n      };\n\n      yelpLocations.push(locObject);\n\n      // when all locations have been loaded then display the markers\n      if (yelpLocations.length > 0) {\n        setMarkers(yelpLocations);\n        vm.locations(yelpLocations);\n        stopLoading();\n      }\n    }).fail(function() {\n      errorHandler('Faild to load data from Yelp. Try again later.')\n    });\n  });\n}\n\n// Initializes the Google Map display\nfunction initializeMap() {\n\n  // Splash.enable('circular');\n\n  var mapContainer = document.getElementById('map');\n\n  var mapOptions = {\n    zoom: (DIMS.width < 662) ? 10 : 16,\n    center: new google.maps.LatLng(\n      CURRENT_LOCATION.lat,\n      CURRENT_LOCATION.lng\n    ),\n    mapTypeId: google.maps.MapTypeId.ROADMAP,\n    mapTypeControl: true,\n    streetViewControl: true\n  };\n  infoWindow = new google.maps.InfoWindow();\n  bounds = new google.maps.LatLngBounds();\n  map = new google.maps.Map(mapContainer, mapOptions);\n\n  panorama = new google.maps.StreetViewPanorama(\n\n      document.getElementById('pano'), {\n        position: fenway,\n        pov: {\n          heading: 14,\n          pitch: 2\n        }\n      });\n\n  map.setStreetView(panorama);\n\n\n  // load in all the location data and place markers\n  getYelpData(LOCATIONS);\n\n  // Bind the ViewModel once loaded\n  ko.applyBindings(vm);\n\n}\n\n// Alerts user when an error occurs\nfunction errorHandler(msg) {\n  if (msg) {\n    $('.error-msg').html(msg);\n  } else {\n    $('.error-msg').html('The page didn\\'t load Google Maps correctly. Try refreshing the page or try again later.');\n  }\n  $('#mapErrorModal').modal('show');\n}\n"]}